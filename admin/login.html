<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Login — PawKind</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
  <script type="module" src="../supabaseClient.js"></script>
  <style>
    body{font-family:Inter,system-ui,Arial;margin:0;background:#f7efe6;color:#222}
    .wrap{max-width:420px;margin:80px auto;background:#fff;padding:28px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.06)}
    label{display:block;margin-top:12px;font-weight:600}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid #eee}
    button{margin-top:18px;padding:10px 14px;border-radius:8px;background:#ff8f6b;border:none;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Admin Login</h2>
    <form id="loginForm">
      <label for="username">Username</label>
      <input id="username" name="username" required>

      <label for="password">Password</label>
      <input id="password" name="password" type="password" required>

      <button type="submit">Sign in</button>
    </form>
    <div style="margin-top:12px;color:var(--muted);font-size:13px">For demo only — use admin created in Supabase table (password_hash is bcrypt hash).</div>
  </div>

  <script type="module">
    import { supabase } from '../supabaseClient.js';

    const loginForm = document.getElementById('loginForm');
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      // fetch admin by username
      const { data, error } = await supabase
        .from('admins')
        .select('id, username, password_hash')
        .eq('username', username)
        .limit(1)
        .single();

      if (error || !data) {
        alert('Invalid username or password.');
        console.error(error);
        return;
      }

      // compare bcrypt hash in browser
      const ok = bcrypt.compareSync(password, data.password_hash);
      if (!ok) {
        alert('Invalid username or password.');
        return;
      }

      // on success: store session (simple) and redirect
      localStorage.setItem('pawkind_admin', JSON.stringify({ id: data.id, username: data.username }));
      window.location.href = '/admin/dashboard.html';
    });
  </script>
</body>
</html>
